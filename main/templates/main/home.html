<!-- church/main/templates/main/home.html -->

<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/form.css" />
    <title>한사랑교회 홈페이지</title>
  </head>
  <body>
    <header class="main-header">
      <div class="logo">
        <a href="/">
          <img src="/images/main.jpg" alt="로고" />
        </a>
      </div>
      <nav class="main-nav">
        <ul>
          <li class="has-submenu">
            <a href="#">교회소개</a>
            <ul class="submenu">
              <li><a href="/greetings.html">인사말</a></li>
              <li><a href="#">비전</a></li>
              <li><a href="#">섬기는 사람들</a></li>
            </ul>
          </li>
          <li class="has-submenu">
            <a href="#">교회소식</a>
            <ul class="submenu">
              <li><a href="/notice.html">공지사항</a></li>
              <li><a href="/sermon.html">주보</a></li>
              <li><a href="#">새가족</a></li>
            </ul>
          </li>
          <li class="has-submenu">
            <a href="#">부서별</a>
            <ul class="submenu">
              <li><a href="#">아동부</a></li>
              <li><a href="#">청소년부</a></li>
              <li><a href="#">청년부</a></li>
              <li><a href="#">장년부</a></li>
            </ul>
          </li>
          <li class="has-submenu">
            <a href="#">예배</a>
            <ul class="submenu">
              <li><a href="#">주일예배</a></li>
              <li><a href="#">수요예배</a></li>
              <li><a href="#">새벽기도회</a></li>
              <li><a href="#">유튜브</a></li>
            </ul>
          </li>
        </ul>
      </nav>
      <div class="user-menu">
        <a href="login.html">로그인</a>
        <a href="register.html">회원가입</a>
      </div>
    </header>

    <section class="main-slider">
      <img src="/images/slider.jpg" alt="메인 슬라이드" />
    </section>

    <footer class="main-footer">
      <div class="footer-links">
        <a href="#">제안 및 문의</a> | <a href="#">이용약관</a>
      </div>
      <p class="footer-info">
        13978 경기도 안양시 박달로 413 (한일아파트상가 2,3층)
      </p>
      <p class="footer-info2">TEL : 031-444-9730 | 010-8134-4849</p>
      <p class="footer-copy">
        COPYRIGHT©2025 한사랑교회 All Rights Reserved. Designed by 손지성 청년
      </p>
    </footer>
    <script>
      const userMenu = document.querySelector(".user-menu");

      // 로그인 상태를 확인하고 UI를 업데이트하는 함수
      async function checkLoginStatus() {
        try {
          const response = await fetch("/api/auth/status");
          const data = await response.json();

          if (data.isLoggedIn) {
            // 로그인 상태일 때: "환영합니다, [아이디]님"과 "로그아웃" 버튼 표시
            let menuHtml = `
                    <a href="/mypage.html" class="welcome-message">환영합니다, ${data.name}님</a>
                    <a href="#" id="logout-btn">로그아웃</a>
                `;

            // **관리자일 경우 '관리자 공간' 버튼 추가**
            if (data.role === "admin") {
              menuHtml = `
                        <a href="/mypage.html" class="welcome-message">환영합니다, ${data.name}님</a>
                        <a href="/admin.html" class="admin-link">관리자 공간</a>
                        <a href="#" id="logout-btn">로그아웃</a>
                    `;
            }

            userMenu.innerHTML = menuHtml;

            // 로그아웃 버튼 클릭 이벤트 리스너 추가
            document
              .getElementById("logout-btn")
              .addEventListener("click", async (e) => {
                e.preventDefault();
                const logoutResponse = await fetch("/logout", {
                  method: "POST",
                });
                if (logoutResponse.ok) {
                  alert("로그아웃 되었습니다.");
                  window.location.reload(); // 페이지 새로고침
                }
              });
          } else {
            // 로그아웃 상태일 때: "로그인"과 "회원가입" 버튼 표시
            userMenu.innerHTML = `
                    <a href="/login.html">로그인</a>
                    <a href="/register.html">회원가입</a>
                `;
          }
        } catch (error) {
          console.error("로그인 상태 확인 오류:", error);
          // 오류 발생 시 기본값 표시
          userMenu.innerHTML = `
                <a href="/login.html">로그인</a>
                <a href="/register.html">회원가입</a>
            `;
        }
      }

      // 페이지 로드 시 로그인 상태 확인 함수 실행
      document.addEventListener("DOMContentLoaded", checkLoginStatus);
    </script>
  </body>
</html>
